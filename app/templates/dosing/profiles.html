{% extends "base.html" %}

{% block title %}Plant Profiles | NuTetra Controller{% endblock %}
{% block page_title %}Plant Profiles{% endblock %}

{% block content %}
<div class="page-content">
    <div class="dashboard-section">
        <div class="section-header">
            <h3>Plant Profiles</h3>
            <a href="{{ url_for('dosing.add_profile') }}" class="action-button">
                <i class="fas fa-plus"></i> Add New Profile
            </a>
        </div>
        
        {% if has_incompatibilities %}
        <div class="incompatibility-warning">
            <i class="fas fa-exclamation-triangle"></i>
            <strong>Warning:</strong> Some nutrient combinations may not be compatible. Check the messages above for details and consider adjusting your pump configuration.
        </div>
        {% endif %}
        
        <div class="profiles-grid">
            {% for profile_id, profile in profiles.items() %}
            <div class="profile-card">
                <div class="profile-header">
                    <h4>{{ profile.name }}</h4>
                    <span class="profile-badge {% if profile_id in default_profiles %}default{% else %}custom{% endif %}">
                        {{ 'Default' if profile_id in default_profiles else 'Custom' }}
                    </span>
                </div>
                <div class="profile-content">
                    <p class="profile-description">{{ profile.description }}</p>
                    
                    <div class="profile-details">
                        <div class="detail-row">
                            <span class="detail-label">pH:</span>
                            <span class="detail-value">{{ profile.ph_setpoint }}±{{ profile.ph_buffer }}</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">EC:</span>
                            <span class="detail-value">{{ profile.ec_setpoint }}±{{ profile.ec_buffer }} μS/cm</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Temperature:</span>
                            <span class="detail-value">{{ profile.temp_min }}-{{ profile.temp_max }}°C</span>
                        </div>
                        
                        {% if profile.nutrient_components %}
                        <div class="components-list">
                            <h5>Nutrient Configuration</h5>
                            <ul>
                                {% for component in profile.nutrient_components %}
                                <li>
                                    <span class="component-name">{{ component.pump_name }}</span>
                                    <span class="component-ratio">{{ component.ratio }}</span>
                                    {% if component.nutrient_type %}
                                    <span class="component-type">{{ component.nutrient_type }}</span>
                                    {% endif %}
                                </li>
                                {% endfor %}
                            </ul>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="profile-actions">
                        {% if profile_id not in default_profiles %}
                        <form method="POST" action="{{ url_for('dosing.delete_profile', profile_id=profile_id) }}" class="inline-form">
                            <button type="submit" class="action-button danger small" onclick="return confirm('Are you sure you want to delete this profile?');">
                                <i class="fas fa-trash"></i>
                            </button>
                        </form>
                        <a href="{{ url_for('dosing.edit_profile', profile_id=profile_id) }}" class="action-button small">
                            <i class="fas fa-edit"></i>
                        </a>
                        {% endif %}
                        <form method="POST" action="{{ url_for('dosing.duplicate_profile', profile_id=profile_id) }}" class="inline-form">
                            <button type="submit" class="action-button small">
                                <i class="fas fa-copy"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div class="back-link">
            <a href="{{ url_for('dosing.settings') }}" class="button">
                <i class="fas fa-arrow-left"></i> Back to Dosing Settings
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
    /* Generic styles */
    .inline-form {
        display: inline-block;
    }
    
    /* Profiles grid */
    .profiles-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-lg);
    }
    
    .profile-card {
        background-color: var(--bg-color-lighter);
        border-radius: var(--border-radius);
        border: 1px solid var(--border-color);
        overflow: hidden;
    }
    
    .profile-header {
        background-color: var(--bg-color-light);
        padding: var(--spacing-md);
        border-bottom: 1px solid var(--border-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .profile-header h4 {
        margin: 0;
        font-size: 1.1rem;
    }
    
    .profile-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 0.8rem;
        font-weight: 500;
    }
    
    .profile-badge.default {
        background-color: var(--info-color-light);
        color: var(--info-color);
    }
    
    .profile-badge.custom {
        background-color: var(--warning-color-light);
        color: var(--warning-color);
    }
    
    .profile-content {
        padding: var(--spacing-md);
    }
    
    .profile-description {
        color: var(--text-color-muted);
        margin-bottom: var(--spacing-md);
        font-size: 0.9rem;
    }
    
    .profile-details {
        margin-bottom: var(--spacing-md);
    }
    
    .detail-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
    }
    
    .detail-label {
        color: var(--text-color-muted);
        font-weight: 500;
    }
    
    .profile-actions {
        display: flex;
        justify-content: flex-end;
        gap: var(--spacing-xs);
    }
    
    .action-button.small {
        padding: 4px 8px;
        font-size: 0.9rem;
    }
    
    .action-button.danger {
        background-color: var(--danger-color-light);
        color: var(--danger-color);
    }
    
    .action-button.danger:hover {
        background-color: var(--danger-color);
        color: white;
    }
    
    .back-link {
        margin-top: var(--spacing-lg);
    }
    
    /* Nutrient components styles */
    .components-list {
        margin-top: var(--spacing-md);
        border-top: 1px solid var(--border-color);
        padding-top: var(--spacing-sm);
    }
    
    .components-list h5 {
        font-size: 0.9rem;
        margin-bottom: var(--spacing-xs);
        color: var(--text-color-muted);
    }
    
    .components-list ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .components-list li {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 4px;
        font-size: 0.85rem;
    }
    
    .component-name {
        flex: 2;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    .component-ratio {
        flex: 1;
        text-align: center;
        font-weight: 500;
    }
    
    .component-type {
        flex: 1;
        text-align: right;
        color: var(--text-color-muted);
        font-style: italic;
    }
    
    /* Incompatibility warning */
    .incompatibility-warning {
        margin-bottom: var(--spacing-md);
        padding: var(--spacing-sm);
        background-color: var(--warning-color-light);
        border-radius: var(--border-radius);
        color: var(--warning-color);
        font-size: 0.9rem;
    }
    
    .incompatibility-warning i {
        margin-right: var(--spacing-xs);
    }
</style>
{% endblock %} 