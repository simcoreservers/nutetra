{% extends "base.html" %}

{% block title %}Sensors | NuTetra Controller{% endblock %}

{% block content %}
<div class="container">
    <div class="row mb-4 align-items-center">
        <div class="col-md-8">
            <h1><i class="fas fa-flask me-2"></i>Sensor Management</h1>
            <p class="lead text-muted">Monitor and calibrate your nutrient solution sensors.</p>
        </div>
        <div class="col-md-4 text-md-end">
            <a href="{{ url_for('sensors.history') }}" class="btn btn-outline-primary">
                <i class="fas fa-chart-line me-1"></i> View All History
            </a>
        </div>
    </div>

    <div class="row">
        <!-- pH Sensor Card -->
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm border-0">
                <div class="card-header bg-gradient {{ 'connected' if get_sensor_status('ph') == 'connected' else 'disconnected' }}">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-tint me-2"></i>pH Sensor
                        </h5>
                        <span class="badge {{ 'bg-success' if get_sensor_status('ph') == 'connected' else 'bg-danger' }}">
                            {{ get_sensor_status('ph')|title }}
                        </span>
                    </div>
                </div>
                <div class="card-body d-flex flex-column">
                    {% set ph_reading = get_last_reading('ph') %}
                    <div class="current-reading text-center mb-3">
                        <h2 class="reading-value display-3 {{ 'text-success' if ph_reading is not none else 'text-muted' }}">
                            {{ ph_reading|ph }}
                        </h2>
                        <div class="reading-range small text-muted">
                            <i class="fas fa-bullseye me-1"></i>Target Range: {{ settings.get('ph_target_min', 5.8)|ph }} - {{ settings.get('ph_target_max', 6.2)|ph }}
                        </div>
                    </div>
                    
                    <div class="mt-auto">
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('sensors.calibration') }}" class="btn btn-primary">
                                <i class="fas fa-sliders-h me-1"></i> Calibrate
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- EC Sensor Card -->
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm border-0">
                <div class="card-header bg-gradient {{ 'connected' if get_sensor_status('ec') == 'connected' else 'disconnected' }}">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-bolt me-2"></i>EC Sensor
                        </h5>
                        <span class="badge {{ 'bg-success' if get_sensor_status('ec') == 'connected' else 'bg-danger' }}">
                            {{ get_sensor_status('ec')|title }}
                        </span>
                    </div>
                </div>
                <div class="card-body d-flex flex-column">
                    {% set ec_reading = get_last_reading('ec') %}
                    <div class="current-reading text-center mb-3">
                        <h2 class="reading-value display-3 {{ 'text-success' if ec_reading is not none else 'text-muted' }}">
                            {{ ec_reading|ec }}
                        </h2>
                        <div class="reading-range small text-muted">
                            <i class="fas fa-bullseye me-1"></i>Target Range: {{ settings.get('ec_target_min', 1.2)|ec }} - {{ settings.get('ec_target_max', 1.5)|ec }}
                        </div>
                    </div>
                    
                    <div class="mt-auto">
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('sensors.calibration') }}" class="btn btn-primary">
                                <i class="fas fa-sliders-h me-1"></i> Calibrate
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Temperature Sensor Card -->
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm border-0">
                <div class="card-header bg-gradient {{ 'connected' if get_sensor_status('temp') == 'connected' else 'disconnected' }}">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-thermometer-half me-2"></i>Temperature
                        </h5>
                        <span class="badge {{ 'bg-success' if get_sensor_status('temp') == 'connected' else 'bg-danger' }}">
                            {{ get_sensor_status('temp')|title }}
                        </span>
                    </div>
                </div>
                <div class="card-body d-flex flex-column">
                    {% set temp_reading = get_last_reading('temp') %}
                    <div class="current-reading text-center mb-3">
                        <h2 class="reading-value display-3 {{ 'text-success' if temp_reading is not none else 'text-muted' }}">
                            {{ temp_reading|temp }}
                        </h2>
                        <div class="reading-range small text-muted">
                            <i class="fas fa-bullseye me-1"></i>Target Range: {{ settings.get('temp_target_min', 18.0)|temp }} - {{ settings.get('temp_target_max', 24.0)|temp }}
                        </div>
                    </div>
                    
                    <div class="mt-auto">
                        <div class="d-grid gap-2">
                            <a href="{{ url_for('sensors.calibration') }}" class="btn btn-primary">
                                <i class="fas fa-sliders-h me-1"></i> Calibrate
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="row mt-4">
        <div class="col-12">
            <div class="card shadow-sm border-0">
                <div class="card-header bg-gradient-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-cogs me-2"></i>Sensor Settings
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post" action="{{ url_for('api.update_settings') }}">
                        <div class="row">
                            <!-- pH Settings -->
                            <div class="col-md-4 mb-4">
                                <div class="settings-group border-start border-4 border-primary ps-3">
                                    <h6 class="mb-3 text-primary"><i class="fas fa-tint me-1"></i> pH Settings</h6>
                                    <div class="form-group mb-3">
                                        <label for="ph_target_min" class="form-label">Target Minimum</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="ph_target_min" name="ph_target_min" 
                                                   value="{{ settings.get('ph_target_min', 5.8) }}" step="0.1" min="0" max="14">
                                            <span class="input-group-text">pH</span>
                                        </div>
                                    </div>
                                    <div class="form-group mb-3">
                                        <label for="ph_target_max" class="form-label">Target Maximum</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="ph_target_max" name="ph_target_max" 
                                                   value="{{ settings.get('ph_target_max', 6.2) }}" step="0.1" min="0" max="14">
                                            <span class="input-group-text">pH</span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="ph_check_interval" class="form-label">Check Interval</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="ph_check_interval" name="ph_check_interval" 
                                                   value="{{ settings.get('ph_check_interval', 300) }}" step="10" min="10">
                                            <span class="input-group-text">sec</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- EC Settings -->
                            <div class="col-md-4 mb-4">
                                <div class="settings-group border-start border-4 border-warning ps-3">
                                    <h6 class="mb-3 text-warning"><i class="fas fa-bolt me-1"></i> EC Settings</h6>
                                    <div class="form-group mb-3">
                                        <label for="ec_target_min" class="form-label">Target Minimum</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="ec_target_min" name="ec_target_min" 
                                                   value="{{ settings.get('ec_target_min', 1200) }}" step="50" min="0">
                                            <span class="input-group-text">μS/cm</span>
                                        </div>
                                    </div>
                                    <div class="form-group mb-3">
                                        <label for="ec_target_max" class="form-label">Target Maximum</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="ec_target_max" name="ec_target_max" 
                                                   value="{{ settings.get('ec_target_max', 1500) }}" step="50" min="0">
                                            <span class="input-group-text">μS/cm</span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="ec_check_interval" class="form-label">Check Interval</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="ec_check_interval" name="ec_check_interval" 
                                                   value="{{ settings.get('ec_check_interval', 300) }}" step="10" min="10">
                                            <span class="input-group-text">sec</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Temperature Settings -->
                            <div class="col-md-4 mb-4">
                                <div class="settings-group border-start border-4 border-danger ps-3">
                                    <h6 class="mb-3 text-danger"><i class="fas fa-thermometer-half me-1"></i> Temperature Settings</h6>
                                    <div class="form-group mb-3">
                                        <label for="temp_target_min" class="form-label">Target Minimum</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="temp_target_min" name="temp_target_min" 
                                                   value="{{ settings.get('temp_target_min', 18.0) }}" step="0.5" min="0">
                                            <span class="input-group-text">°C</span>
                                        </div>
                                    </div>
                                    <div class="form-group mb-3">
                                        <label for="temp_target_max" class="form-label">Target Maximum</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="temp_target_max" name="temp_target_max" 
                                                   value="{{ settings.get('temp_target_max', 24.0) }}" step="0.5" min="0">
                                            <span class="input-group-text">°C</span>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label for="temp_check_interval" class="form-label">Check Interval</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="temp_check_interval" name="temp_check_interval" 
                                                   value="{{ settings.get('temp_check_interval', 300) }}" step="10" min="10">
                                            <span class="input-group-text">sec</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-lg btn-primary">
                                <i class="fas fa-save me-2"></i>Save Settings
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Custom styles for the sensor management page */
.card-header.connected {
    background-color: #28a745;
    background-image: linear-gradient(45deg, #28a745, #20c997);
    color: white;
}

.card-header.disconnected {
    background-color: #dc3545;
    background-image: linear-gradient(45deg, #dc3545, #fd7e14);
    color: white;
}

.bg-gradient-primary {
    background-color: #007bff;
    background-image: linear-gradient(45deg, #007bff, #6610f2);
}

.reading-value {
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.settings-group {
    transition: all 0.3s ease;
    padding: 15px;
    border-radius: 5px;
}

.settings-group:hover {
    background-color: rgba(0,0,0,0.02);
}

.card {
    transition: all 0.3s ease;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15) !important;
}
</style>
{% endblock %} 